<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Hangman</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <h1>Hangman - Australian Animals</h1>
    <div>
        <h3 id="start">Press ENTER to start</h3>
        <h2>Current Word</h2>
        <h3 id="current-word"></h3>
    </div>
    <h4>guesses remaining</h4>
    <h4 id="attempts"></h4>
    <h5>letters already guessed</h5>
    <p id="letters-guessed"></p>

    <script type="text/javascript">
    
    //make the GLOBAL variables
    //create the global array of animal words to randomly select
    var animals = [
            "emu",
            "kookaburra",
            "kangaroo",
            "wallaby",
            "koala",
            "platypus",
            "echidna",
            "pademelon",
            "wombat"
        ];

    //empty arrays for LETTERS GUESSED and THE CURRENT WORD
    var lettersGuessed = [];
    //empty array for the current randomly selected word
    var guessingWord = [];

    //variable for remaining attempts
    // var remainingAttempts = 10;

    //global variable for the current word's index - EMPTY
    var currentWordIndex;

    //variable to check the status of the game
    var complete = false;


// ========================================================================
// FUNCTIONS
//=========================================================================

   //function to clear variables and START game
   function startGame() {
       //clear the display of word text
       
       //use a random number to assign a value to the currentWordIndex using the length of the animals array
       currentWordIndex = Math.floor(Math.random() * (animals.length));

       //clear the other arrays / variables
       lettersGuessed = [];

       //separate array to store the current word randomly selected
       guessingWord = [];

       remainingAttempts = 5;

       //make the guessingWord and clear the letters
       for(var i = 0; i < animals[currentWordIndex].length; i++) {
           guessingWord.push(" _ ");
       }
       //CALL FUNCTION TO RESET DISPLAY AND SHOW WORD BLANKS
       // TO DO
       resetDisplay();

   }

   function resetDisplay() {
       //CLEAR THE PRESS ENTER SCREEN
       document.getElementById("start").innerText = "";
       //clear the space and display the current word with blanks
       document.getElementById("current-word").innerText = "";
       for(var j = 0; j < guessingWord.length; j++) {
           document.getElementById("current-word").innerText += guessingWord[j];
       }
       //show the remaining attempts the player has to guess the word
       document.getElementById("attempts").innerText = remainingAttempts;
       //display the lettersGuessed array - which begins empty
       document.getElementById("letters-guessed").innerText = lettersGuessed.join(" ");
       //reset for when guesses are empty 
       if(remainingAttempts < 1) {
            //FIX THIS SO THE GAME PAUSES AND PROMPTS THE PLAYER FOR A RESET
            //This restarts the game loop
            document.getElementById("start").innerText = "Press Enter to start a new game";
            complete = true;
       }
   }

    //FUNCTION FOR UPDATING THE HANGMAN IMAGE if I choose to include it - you would need to add a MAX TRIES variable if so
    // Updates the image depending on how many guesses
    // function updateHangmanImage() {
    //     document.getElementById("hangmanImage").src = "assets/images/" + (maxTries - remainingGuesses) + ".png";
    // };

    function makeGuess(letter) {
        //if letter chosen by player is not in the letters already guessed array, then add to it - and then evaluate the letter in relation to the chosen word
        if(lettersGuessed.indexOf(letter) === -1) {
            lettersGuessed.push(letter);
            evaluateGuess(letter);
        }
        //check for a win and update the display with current variable values
        checkSolution();
        resetDisplay();
    }

    //if word not already picked, find current word's letters and replace the blanks in display with chosen letter
    function evaluateGuess(letter) {
        //make an empty array to store word indexes in - HELPS SOLVE THE MULTIPLE LETTERS PROBLEM
        var indexes = [];

        //loop through word to find ALL indexes of letter guessed
        for(var k = 0; k < animals[currentWordIndex].length; k++) {
            if(animals[currentWordIndex][k] === letter) {
                indexes.push(k);
            }
        }
        //if no matching indexes remove an attempt 
        if(indexes.length <= 0) {
            remainingAttempts--;
        } else {
            //loop through the word and replace the " _ " with letters
            for(var l = 0; l < indexes.length; l++) {
                guessingWord[indexes[l]] = " " + letter + " ";
            }
        }
    }

    //check if the word has been solved
    function checkSolution() {
        //if there are no more blanks in the array, restart the game
        if(guessingWord.indexOf(" _ ") === -1) {
            startGame();
        }
    }

    //event listener for the keypress functionality
    document.onkeyup = function(event) {
        var userKey = event.key;

        // FIX BUG HERE
        // if(userKey === "Enter") {
        //     startGame();
        //     resetDisplay();
        // }

        if(complete && userKey === "Enter") {
            startGame();
            complete = false;
        }
        //otherwise listen for keypresses between A and Z
        if(event.keyCode >= 65 && event.keyCode <= 90) {
            // console.log(userKey);
            makeGuess(event.key.toLowerCase());
        }
    }

    //TEMPORARY CALLED FUNCTIONS TO TEST FUNCTIONALITY
    startGame();
    
    </script>
    
</body>
</html>